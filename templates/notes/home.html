
{% extends "base.html" %}
{% block title %}ููุญุฉ ุชุญูู ุงููุณุชุฎุฏู{% endblock %}
{% block content %}
<!-- ุฑุณู ุจูุงูู ููุฅุญุตุงุฆูุงุช (ูุฎุทุท ุฏุงุฆุฑู) -->
<div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl p-6 mb-10 flex flex-col items-center">
    <h3 class="text-lg font-bold text-blue-800 dark:text-blue-200 mb-4 flex items-center gap-2"><i class="fas fa-chart-pie"></i> ุชูุฒูุน ุงููุซุงุฆู</h3>
    <canvas id="statsPie" width="320" height="180"></canvas>
</div>

<!-- ูุณู ุขุฎุฑ ุงูุชุบููุฑุงุช -->
<div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl p-6 mb-10">
    <h3 class="text-lg font-bold text-blue-800 dark:text-blue-200 mb-4 flex items-center gap-2"><i class="fas fa-history"></i> ุขุฎุฑ ุชุบููุฑุงุช ุงูุตูุงุญูุงุช</h3>
    <ul class="divide-y divide-gray-200 dark:divide-gray-700">
        {% for log in last_role_changes|slice:":0:5" %}
        <li class="py-2 flex items-center gap-2 text-sm">
            <span class="font-bold text-blue-700 dark:text-blue-200">{{ log.changed_user.username }}</span>
            <span>ุชู ุชุบููุฑ ุตูุงุญูุฉ ุงููุณุชุฎุฏู ูู</span>
            <span class="font-bold text-red-600 dark:text-red-300">{{ log.old_role }}</span>
            <span>ุฅูู</span>
            <span class="font-bold text-green-600 dark:text-green-300">{{ log.new_role }}</span>
            <span class="text-gray-400">({{ log.timestamp|date:"Y-m-d H:i" }})</span>
        </li>
        {% empty %}
        <li class="py-2 text-gray-400">ูุง ุชูุฌุฏ ุชุบููุฑุงุช ุญุฏูุซุฉ.</li>
        {% endfor %}
    </ul>
</div>

<!-- ูุณู ุฑูุงุจุท ูุณุงุนุฏุฉ -->
<div class="flex flex-wrap gap-4 mb-10 justify-center">
    <a href="https://docs.djangoproject.com/" target="_blank" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 shadow flex items-center gap-2"><i class="fas fa-book"></i> ุชูุซูู Django</a>
    <a href="https://fontawesome.com/icons" target="_blank" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 shadow flex items-center gap-2"><i class="fas fa-icons"></i> ุฃููููุงุช ุฅุถุงููุฉ</a>
    <a href="mailto:support@yourdomain.com" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 shadow flex items-center gap-2"><i class="fas fa-envelope"></i> ุงูุฏุนู ุงูููู</a>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ุฑุณู ูุฎุทุท ุฏุงุฆุฑู ููุฅุญุตุงุฆูุงุช
const ctx = document.getElementById('statsPie').getContext('2d');
const statsPie = new Chart(ctx, {
    type: 'pie',
    data: {
        labels: ['ุงููุดุทุฉ', 'ุงููุคุฑุดูุฉ', 'ุงูููุชููุฉ'],
        datasets: [{
            data: [{{ stats.active }}, {{ stats.archived }}, {{ stats.expired }}],
            backgroundColor: ['#22c55e', '#3b82f6', '#facc15'],
        }]
    },
    options: {
        responsive: false,
        plugins: { legend: { position: 'bottom', labels: { font: { family: 'Tajawal, sans-serif' } } } }
    }
});
</script>

<h1 class="text-3xl font-extrabold text-blue-800 dark:text-blue-300 mb-8 text-center drop-shadow-lg">๐ ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ</h1>

<!-- ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู -->
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-7 mb-10 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div class="flex flex-col gap-2">
        <h2 class="text-xl font-bold mb-2 text-blue-900 dark:text-blue-200">๐ฅ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</h2>
        <div class="flex flex-wrap gap-2">
            <a href="{% url 'register' %}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 shadow">ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ</a>
            <a href="{% url 'user_management' %}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 shadow">ุนุฑุถ/ุญุฐู ุงููุณุชุฎุฏููู</a>
            <a href="{% url 'role_change_log' %}" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 shadow">ุณุฌู ุชุบููุฑุงุช ุงูุตูุงุญูุงุช</a>
            <a href="{% url 'login_history' %}" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-900 shadow">ุณุฌู ุฏุฎูู ุงููุณุชุฎุฏููู</a>
        </div>
    </div>
</div>



<!-- ุฅุญุตุงุฆูุงุช ูููุญุงุช ุณุฑูุนุฉ -->
<div class="grid grid-cols-2 md:grid-cols-5 gap-6 mb-10">
    <a href="{% url 'archived_notes' %}" class="bg-gradient-to-tr from-blue-100 to-blue-300 dark:from-blue-900 dark:to-blue-700 p-7 rounded-2xl shadow-lg hover:scale-105 transition-transform">
        <div class="text-2xl font-extrabold text-blue-800 dark:text-blue-200">{{ stats.archived }}</div>
        <div class="text-base text-blue-900 dark:text-blue-100 mt-2">ุงููุซุงุฆู ุงููุคุฑุดูุฉ</div>
    </a>
    <a href="{% url 'expired_notes' %}" class="bg-gradient-to-tr from-red-100 to-yellow-200 dark:from-red-900 dark:to-yellow-700 p-7 rounded-2xl shadow-lg hover:scale-105 transition-transform">
        <div class="text-2xl font-extrabold text-red-700 dark:text-yellow-200">{{ stats.expired }}</div>
        <div class="text-base text-red-900 dark:text-yellow-100 mt-2">ุงููุซุงุฆู ุงูููุชููุฉ</div>
    </a>
    <a href="{% url 'user_notes' %}" class="bg-gradient-to-tr from-green-100 to-green-300 dark:from-green-900 dark:to-green-700 p-7 rounded-2xl shadow-lg hover:scale-105 transition-transform">
        <div class="text-2xl font-extrabold text-green-700 dark:text-green-200">{{ stats.active }}</div>
        <div class="text-base text-green-900 dark:text-green-100 mt-2">ุงููุซุงุฆู ุงููุดุทุฉ</div>
    </a>
    <a href="{% url 'profile' %}" class="bg-gradient-to-tr from-purple-100 to-blue-200 dark:from-purple-900 dark:to-blue-700 p-7 rounded-2xl shadow-lg hover:scale-105 transition-transform">
        <div class="text-2xl font-extrabold text-purple-700 dark:text-blue-200">{{ stats.users }}</div>
        <div class="text-base text-purple-900 dark:text-blue-100 mt-2">ุนุฏุฏ ุงููุณุชุฎุฏููู</div>
    </a>
    <!-- ููุญุฉ ุฅุดุนุงุฑุงุช ุณุฑูุนุฉ -->
    <div class="bg-gradient-to-tr from-yellow-100 to-yellow-300 dark:from-yellow-900 dark:to-yellow-700 p-7 rounded-2xl shadow-lg flex flex-col items-center justify-center">
        <div class="text-2xl font-extrabold text-yellow-700 dark:text-yellow-200"><i class="fas fa-bell"></i></div>
        <div class="text-base text-yellow-900 dark:text-yellow-100 mt-2">ุฅุดุนุงุฑุงุช ุงููุธุงู</div>
        <ul class="mt-2 text-sm text-yellow-800 dark:text-yellow-100 list-disc pr-4">
            <li>ุชูุจูู: ุฑุงุฌุน ุงููุซุงุฆู ุงูููุชููุฉ</li>
            <li>ุชุฃูุฏ ูู ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏููู</li>
            <li>ุชุฌุฑุจุฉ ุงููุถุน ุงููููู ูุชุงุญุฉ</li>
        </ul>
    </div>
</div>

<!-- ูููุฒุงุช ุณุฑูุนุฉ -->
<div class="flex flex-wrap gap-4 mb-10 justify-center">
    <a href="{% url 'create_note' %}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 shadow flex items-center gap-2"><i class="fas fa-plus"></i> ุฅูุดุงุก ูุซููุฉ</a>
    <a href="{% url 'user_management' %}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 shadow flex items-center gap-2"><i class="fas fa-users-cog"></i> ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</a>
    <a href="{% url 'archived_notes' %}" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-900 shadow flex items-center gap-2"><i class="fas fa-archive"></i> ุฃุฑุดูู ุงููุซุงุฆู</a>
    <a href="{% url 'profile' %}" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-800 shadow flex items-center gap-2"><i class="fas fa-user"></i> ุงูููู ุงูุดุฎุตู</a>
    <a href="{% url 'login_history' %}" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 shadow flex items-center gap-2"><i class="fas fa-history"></i> ุณุฌู ุงูุฏุฎูู</a>
</div>
<form method="get" class="mb-10 flex flex-col md:flex-row md:items-center md:justify-between gap-4 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
    <a href="{% url 'create_note' %}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 mb-2 md:mb-0 shadow">โ ุฅูุดุงุก ูุซููุฉ ุฌุฏูุฏุฉ</a>
    <input type="text" name="q" value="{{ request.GET.q }}" placeholder="ุจุญุซ ุจุงูุนููุงู..." class="border rounded-lg px-3 py-2 w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-900 dark:text-gray-100">
    <select name="doc_type" class="border rounded-lg px-3 py-2 dark:bg-gray-900 dark:text-gray-100">
        <option value="">ูู ุงูุฃููุงุน</option>
        <option value="administrative" {% if request.GET.doc_type == 'administrative' %}selected{% endif %}>ุฃูุฑ ุฅุฏุงุฑู</option>
        <option value="official" {% if request.GET.doc_type == 'official' %}selected{% endif %}>ูุชุงุจ ุฑุณูู</option>
        <option value="circular" {% if request.GET.doc_type == 'circular' %}selected{% endif %}>ุชุนููู</option>
    </select>
    <input type="date" name="created_at" value="{{ request.GET.created_at }}" class="border rounded-lg px-3 py-2 dark:bg-gray-900 dark:text-gray-100">
    <button type="submit" class="bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-gray-900 shadow">ุจุญุซ ูุชูุฏู</button>
</form>

<!-- ุนุฑุถ ุงููุซุงุฆู -->
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-100 dark:bg-gray-900">
            <tr>
                <th class="text-right px-4 py-2 text-sm text-gray-700 dark:text-gray-200">ุงูุนููุงู</th>
                <th class="text-right px-4 py-2 text-sm text-gray-700 dark:text-gray-200">ุงูููุน</th>
                <th class="text-right px-4 py-2 text-sm text-gray-700 dark:text-gray-200">ุงูุญุงูุฉ</th>
                <th class="text-right px-4 py-2 text-sm text-gray-700 dark:text-gray-200">ุชุงุฑูุฎ ุงูุฅูุดุงุก</th>
                <th class="text-right px-4 py-2 text-sm text-gray-700 dark:text-gray-200">ุนุฑุถ</th>
                <th class="text-right px-4 py-2 text-sm text-gray-700 dark:text-gray-200">ุฃุฑุดูุฉ</th>
                <th class="text-right px-4 py-2 text-sm text-gray-700 dark:text-gray-200">ุญุฐู</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="notesTable">
            {% for note in notes %}
            <tr class="hover:bg-blue-50 dark:hover:bg-gray-900 transition-colors">
                <td class="px-4 py-2 font-semibold">{{ note.title }}</td>
                <td class="px-4 py-2">{{ note.note_type }}</td>
                <td class="px-4 py-2">
                    {% if note.is_archived %}
                        <span class="text-gray-500 dark:text-gray-400">๐ ูุคุฑุดูุฉ</span>
                    {% elif note.expiry_date and note.expiry_date < now %}
                        <span class="text-red-600 dark:text-yellow-300">โฐ ููุชููุฉ</span>
                    {% else %}
                        <span class="text-green-600 dark:text-green-300">โ ูุดุทุฉ</span>
                    {% endif %}
                </td>
                <td class="px-4 py-2">{{ note.created_at|date:"Y-m-d" }}</td>
                <td class="px-4 py-2">
                    <a href="{% url 'note_detail' note.access_token %}" class="text-blue-600 dark:text-blue-300 hover:underline font-bold">ุนุฑุถ</a>
                </td>
                <td class="px-4 py-2">
                    <a href="{% url 'archive_note' note.id %}" class="text-yellow-600 dark:text-yellow-400 hover:underline font-bold" onclick="return confirm('ูู ุชุฑูุฏ ุฃุฑุดูุฉ ูุฐู ุงููุซููุฉุ');">ุฃุฑุดูุฉ</a>
                </td>
                <td class="px-4 py-2">
                    <a href="{% url 'delete_note' note.id %}" class="text-red-600 dark:text-red-400 hover:underline font-bold" onclick="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงููุซููุฉุ');">ุญุฐู</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center text-gray-500 dark:text-gray-400 py-4">ูุง ุชูุฌุฏ ูุซุงุฆู</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<script>
// ุจุญุซ ูุญุธู
const searchInput = document.getElementById('searchInput');
const notesTable = document.getElementById('notesTable');
searchInput.addEventListener('keyup', function() {
    const filter = searchInput.value.toLowerCase();
    Array.from(notesTable.rows).forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
    });
});
</script>
{% endblock %}
