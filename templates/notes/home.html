{% extends 'notes/base.html' %}
{% load static %}

{% block title %}ููุญุฉ ุงูุชุญูู{% endblock %}

{% block content %}

<!-- โ ุนููุงู ุงูุตูุญุฉ -->
<h1 class="text-3xl font-extrabold mb-6 text-blue-800 text-center drop-shadow-lg">๐ ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ</h1>

<!-- โ ุฃุฒุฑุงุฑ ุฅุฏุงุฑุฉ ุงููุซุงุฆู ูุงููุณุชุฎุฏููู ูุงูุฅุดุนุงุฑุงุช ูุงูุฅุนุฏุงุฏุงุช -->
<div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
    <a href="{% url 'create_note' %}" class="bg-blue-700 text-white px-6 py-3 rounded-xl shadow hover:bg-blue-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-plus"></i> ุฅูุดุงุก ูุซููุฉ ุนุงุฏูุฉ</a>
    <a href="{% url 'create_note' %}?private=1" class="bg-purple-700 text-white px-6 py-3 rounded-xl shadow hover:bg-purple-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-lock"></i> ุฅูุดุงุก ูุซููุฉ ุฎุงุตุฉ</a>
    <a href="{% url 'create_note' %}?login_only=1" class="bg-blue-800 text-white px-6 py-3 rounded-xl shadow hover:bg-blue-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-user"></i> ุฅูุดุงุก ูุซููุฉ ุชุธูุฑ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู</a>
    <a href="{% url 'archived_notes' %}" class="bg-yellow-500 text-white px-6 py-3 rounded-xl shadow hover:bg-yellow-600 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-archive"></i> ุงูุฃุฑุดูู</a>
    <a href="{% url 'expired_notes' %}" class="bg-red-500 text-white px-6 py-3 rounded-xl shadow hover:bg-red-700 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-calendar-times"></i> ุงูููุชููุฉ</a>
    <a href="{% url 'outgoing_notes' %}" class="bg-green-600 text-white px-6 py-3 rounded-xl shadow hover:bg-green-800 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-paper-plane"></i> ุงูุตุงุฏุฑุฉ</a>
    <a href="{% url 'incoming_notes' %}" class="bg-blue-700 text-white px-6 py-3 rounded-xl shadow hover:bg-blue-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-inbox"></i> ุงููุงุฑุฏุฉ</a>
    <a href="{% url 'user_management' %}" class="bg-purple-600 text-white px-6 py-3 rounded-xl shadow hover:bg-purple-800 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-users"></i> ุงููุณุชุฎุฏููู</a>
    <a href="{% url 'stats_dashboard' %}" class="bg-gray-900 text-white px-6 py-3 rounded-xl shadow hover:bg-black transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-chart-bar"></i> ุงูุฅุญุตุงุฆูุงุช</a>
    <a href="{% url 'notifications' %}" class="bg-red-600 text-white px-6 py-3 rounded-xl shadow hover:bg-red-800 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-bell"></i> ุงูุฅุดุนุงุฑุงุช</a>
    {% if user_profile.role == 'admin' or user_profile.role == 'supervisor' %}
    <a href="{% url 'dashboard' %}" class="bg-yellow-500 text-white px-6 py-3 rounded-xl shadow hover:bg-yellow-700 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-cogs"></i> ุงูุฅุนุฏุงุฏุงุช</a>
    {% endif %}
</div>

<!-- โ ุฃุฒุฑุงุฑ ุงูุณุฌูุงุช ูุงูุฃูุดุทุฉ -->
<div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
    <a href="{% url 'search_log' %}" class="bg-gray-700 text-white px-6 py-3 rounded-xl shadow hover:bg-gray-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-search"></i> ุณุฌู ุงูุจุญุซ</a>
    <a href="{% url 'archive_log' %}" class="bg-indigo-600 text-white px-6 py-3 rounded-xl shadow hover:bg-indigo-800 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-folder"></i> ุณุฌู ุงูุฃุฑุดูุฉ</a>
    <a href="{% url 'login_history' %}" class="bg-green-800 text-white px-6 py-3 rounded-xl shadow hover:bg-green-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-sign-in-alt"></i> ุณุฌู ุงูุฏุฎูู</a>
    <a href="{% url 'role_change_log' %}" class="bg-yellow-700 text-white px-6 py-3 rounded-xl shadow hover:bg-yellow-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-user-cog"></i> ุชุบููุฑ ุงูุฃุฏูุงุฑ</a>
    <a href="{% url 'activity_log' %}" class="bg-red-700 text-white px-6 py-3 rounded-xl shadow hover:bg-red-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-tasks"></i> ุณุฌู ุงูุฃูุดุทุฉ</a>
    <a href="{% url 'access_log' %}" class="bg-blue-700 text-white px-6 py-3 rounded-xl shadow hover:bg-teal-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-file-alt"></i> ุณุฌู ุงููุตูู</a>
</div>

<!-- โ ุฅุญุตุงุฆูุงุช -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    <div class="bg-blue-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">ุงููุณุชุฎุฏููู</h4>
        <!-- ููููู ููุง ูุถุน ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏููู -->
    </div>
    <div class="bg-green-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">ุงููุซุงุฆู ุงููุดุทุฉ</h4>
        <!-- ุฅุญุตุงุฆูุงุช ุฃุฎุฑู -->
    </div>
    <div class="bg-yellow-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">ุงููุซุงุฆู ุงูููุชููุฉ</h4>
        <!-- ุฅุญุตุงุฆูุงุช ุฃุฎุฑู -->
    </div>
    <div class="bg-red-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">ุงูุฃุฎุจุงุฑ</h4>
        <!-- ุฅุญุตุงุฆูุงุช ุฃุฎุฑู -->
    </div>
</div>

<!-- ูุงุฌูุฉ ููุณููุฉ ููุตููู: ุงููุซุงุฆู ูุงูุฃุฎุจุงุฑ -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
    <!-- ุงููุตู ุงูุฃูู: ุงููุซุงุฆู -->
    <div class="bg-white rounded-2xl shadow-xl p-6">
        <h2 class="text-2xl font-bold text-blue-800 mb-4 flex items-center gap-2"><i class="fas fa-folder-open"></i> ุงููุซุงุฆู</h2>
        <!-- ูููุฐุฌ ุงูุจุญุซ -->
        <form method="get" class="mb-4 flex flex-col gap-2">
            <input type="text" name="q" placeholder="ุจุญุซ ุจุนููุงู ุงููุซููุฉ..." value="{{ request.GET.q|default:'' }}" class="border p-2 rounded" />
            <select name="doc_type" class="border p-2 rounded">
                <option value="">ูู ุงูุฃููุงุน</option>
                <option value="official" {% if request.GET.doc_type == 'official' %}selected{% endif %}>ูุชุงุจ ุฑุณูู</option>
                <option value="administrative" {% if request.GET.doc_type == 'administrative' %}selected{% endif %}>ุฃูุฑ ุฅุฏุงุฑู</option>
                <option value="circular" {% if request.GET.doc_type == 'circular' %}selected{% endif %}>ุชุนููู</option>
            </select>
            <input type="date" name="created_at" value="{{ request.GET.created_at|default:'' }}" class="border p-2 rounded" />
            <button type="submit" class="bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-900">ุจุญุซ</button>
        </form>
        <!-- ุฌุฏูู ุงููุซุงุฆู -->
<div class="overflow-x-auto rounded-xl shadow">
    <table class="min-w-full text-sm text-right">
        <thead class="bg-gray-100">
            <tr>
                <th class="px-4 py-2">๐ ุงูุนููุงู</th>
                <th class="px-4 py-2">๐ ุงูููุน</th>
                <th class="px-4 py-2">๐ ุงูุฅูุดุงุก</th>
                <th class="px-4 py-2">๐ก๏ธ ุงูุญุงูุฉ</th>
                <th class="px-4 py-2">โ๏ธ ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
        </thead>
        <tbody>
            {% for note in notes %}
            <tr class="border-t hover:bg-blue-50">
                <td class="px-4 py-2 font-semibold">{{ note.title }}</td>
                <td class="px-4 py-2">{{ note.get_doc_type_display }}</td>
                <td class="px-4 py-2">{{ note.created_at|date:"Y-m-d" }}</td>
                <td class="px-4 py-2">
                    {% if note.is_archived %}
                        <span class="text-pink-700 font-bold">ูุคุฑุดูุฉ</span>
                    {% elif note.expiry_date and note.expiry_date < now %}
                        <span class="text-yellow-700 font-bold">ููุชููุฉ</span>
                    {% else %}
                        <span class="text-green-700 font-bold">ูุดุทุฉ</span>
                    {% endif %}
                </td>
                <td class="px-4 py-2 flex flex-wrap gap-2">
                    <a href="{% url 'note_detail' note.access_token %}" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-700 transition text-sm">ุนุฑุถ</a>

                    {% if note.file %}
                    <a href="{{ note.file.url }}" download class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-700 transition text-sm">ุชุญููู</a>
                    {% endif %}

                    <!-- ุฒุฑ ุงูุฃุฑุดูุฉ -->
                    <form method="post" action="{% url 'archive_note' note.pk %}" class="inline">
                        {% csrf_token %}
                        <button type="submit" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition text-sm"
                                onclick="return confirm('ูู ุชุฑูุฏ ุฃุฑุดูุฉ ูุฐู ุงููุซููุฉุ')">ุฃุฑุดูุฉ</button>
                    </form>

                    <!-- ุฒุฑ ุงูุญุฐู -->
                    <form method="post" action="{% url 'delete_note' note.pk %}" class="inline">
                        {% csrf_token %}
                        <button type="submit" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition text-sm"
                                onclick="return confirm('โ๏ธ ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงููุซููุฉุ')">ุญุฐู</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if notes|length == 0 %}
        <div class="text-center text-gray-500 py-4">๐ญ ูุง ุชูุฌุฏ ูุซุงุฆู ูุชุงุญุฉ.</div>
    {% endif %}
</div>
    </div>
    <!-- ุงููุตู ุงูุซุงูู: ุงูุฃุฎุจุงุฑ -->
    <div class="bg-white rounded-2xl shadow-xl p-6">
        <h2 class="text-2xl font-bold text-red-700 mb-4 flex items-center gap-2"><i class="fas fa-newspaper"></i> ุขุฎุฑ ุงูุฃุฎุจุงุฑ</h2>
        <div class="mb-4 text-center">
            <a href="{% url 'news' %}" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 shadow transition font-bold"><i class="fas fa-eye"></i> ุนุฑุถ ูู ุงูุฃุฎุจุงุฑ</a>
            {% if user_profile.role == 'admin' or user_profile.role == 'supervisor' %}
            <a href="{% url 'add_news' %}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 shadow transition font-bold ml-2"><i class="fas fa-plus"></i> ูุดุฑ ุฎุจุฑ ุฌุฏูุฏ</a>
            {% endif %}
        </div>
        {% if news_list %}
        <ul class="space-y-4">
            {% for news in news_list|slice:':3' %}
            <li class="bg-gray-50 rounded-xl shadow p-4 flex gap-4 items-center">
                {% if news.image %}
                <img src="{{ news.image.url }}" alt="ุตูุฑุฉ ุงูุฎุจุฑ" class="w-20 h-20 object-cover rounded-xl border">
                {% endif %}
                <div>
                    <h3 class="text-lg font-bold text-blue-700 mb-1">{{ news.title }}</h3>
                    <p class="text-gray-700 mb-2">{{ news.content|truncatechars:60 }}</p>
                    <span class="text-xs text-gray-500"><i class="fas fa-clock"></i> {{ news.created_at|date:"Y-m-d H:i" }}</span>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="text-center text-gray-400 py-8">ูุง ุชูุฌุฏ ุฃุฎุจุงุฑ ุญุงููุงู.</div>
        {% endif %}
    </div>
</div>

{% endblock %}
