{% extends 'notes/base.html' %}
{% load static %}

{% block title %}لوحة التحكم{% endblock %}

{% block content %}

<!-- ✅ عنوان الصفحة -->
<h1 class="text-3xl font-extrabold mb-6 text-blue-800 text-center drop-shadow-lg">📊 لوحة التحكم الرئيسية</h1>

<!-- ✅ أزرار إدارة الوثائق والمستخدمين والإشعارات والإعدادات -->
<div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
    <a href="{% url 'create_note' %}" class="bg-blue-700 text-white px-6 py-3 rounded-xl shadow hover:bg-blue-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-plus"></i> إنشاء وثيقة عادية</a>
    <a href="{% url 'create_note' %}?private=1" class="bg-purple-700 text-white px-6 py-3 rounded-xl shadow hover:bg-purple-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-lock"></i> إنشاء وثيقة خاصة</a>
    <a href="{% url 'create_note' %}?login_only=1" class="bg-blue-800 text-white px-6 py-3 rounded-xl shadow hover:bg-blue-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-user"></i> إنشاء وثيقة تظهر بعد تسجيل الدخول</a>
    <a href="{% url 'archived_notes' %}" class="bg-yellow-500 text-white px-6 py-3 rounded-xl shadow hover:bg-yellow-600 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-archive"></i> الأرشيف</a>
    <a href="{% url 'expired_notes' %}" class="bg-red-500 text-white px-6 py-3 rounded-xl shadow hover:bg-red-700 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-calendar-times"></i> المنتهية</a>
    <a href="{% url 'outgoing_notes' %}" class="bg-green-600 text-white px-6 py-3 rounded-xl shadow hover:bg-green-800 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-paper-plane"></i> الصادرة</a>
    <a href="{% url 'incoming_notes' %}" class="bg-blue-700 text-white px-6 py-3 rounded-xl shadow hover:bg-blue-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-inbox"></i> الواردة</a>
    <a href="{% url 'user_management' %}" class="bg-purple-600 text-white px-6 py-3 rounded-xl shadow hover:bg-purple-800 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-users"></i> المستخدمون</a>
    <a href="{% url 'stats_dashboard' %}" class="bg-gray-900 text-white px-6 py-3 rounded-xl shadow hover:bg-black transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-chart-bar"></i> الإحصائيات</a>
    <a href="{% url 'notifications' %}" class="bg-red-600 text-white px-6 py-3 rounded-xl shadow hover:bg-red-800 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-bell"></i> الإشعارات</a>
    {% if user_profile.role == 'admin' or user_profile.role == 'supervisor' %}
    <a href="{% url 'dashboard' %}" class="bg-yellow-500 text-white px-6 py-3 rounded-xl shadow hover:bg-yellow-700 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-cogs"></i> الإعدادات</a>
    {% endif %}
</div>

<!-- ✅ أزرار السجلات والأنشطة -->
<div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
    <a href="{% url 'search_log' %}" class="bg-gray-700 text-white px-6 py-3 rounded-xl shadow hover:bg-gray-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-search"></i> سجل البحث</a>
    <a href="{% url 'archive_log' %}" class="bg-indigo-600 text-white px-6 py-3 rounded-xl shadow hover:bg-indigo-800 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-folder"></i> سجل الأرشفة</a>
    <a href="{% url 'login_history' %}" class="bg-green-800 text-white px-6 py-3 rounded-xl shadow hover:bg-green-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-sign-in-alt"></i> سجل الدخول</a>
    <a href="{% url 'role_change_log' %}" class="bg-yellow-700 text-white px-6 py-3 rounded-xl shadow hover:bg-yellow-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-user-cog"></i> تغيير الأدوار</a>
    <a href="{% url 'activity_log' %}" class="bg-red-700 text-white px-6 py-3 rounded-xl shadow hover:bg-red-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-tasks"></i> سجل الأنشطة</a>
    <a href="{% url 'access_log' %}" class="bg-blue-700 text-white px-6 py-3 rounded-xl shadow hover:bg-teal-900 transition flex items-center justify-center gap-2 font-bold"><i class="fas fa-file-alt"></i> سجل الوصول</a>
</div>

<!-- ✅ إحصائيات -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    <div class="bg-blue-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">المستخدمون</h4>
        <!-- يمكنك هنا وضع إحصائيات المستخدمين -->
    </div>
    <div class="bg-green-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">الوثائق النشطة</h4>
        <!-- إحصائيات أخرى -->
    </div>
    <div class="bg-yellow-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">الوثائق المنتهية</h4>
        <!-- إحصائيات أخرى -->
    </div>
    <div class="bg-red-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">الأخبار</h4>
        <!-- إحصائيات أخرى -->
    </div>
</div>

<!-- واجهة مقسومة لنصفين: الوثائق والأخبار -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
    <!-- النصف الأول: الوثائق -->
    <div class="bg-white rounded-2xl shadow-xl p-6">
        <h2 class="text-2xl font-bold text-blue-800 mb-4 flex items-center gap-2"><i class="fas fa-folder-open"></i> الوثائق</h2>
        <!-- نموذج البحث -->
        <form method="get" class="mb-4 flex flex-col gap-2">
            <input type="text" name="q" placeholder="بحث بعنوان الوثيقة..." value="{{ request.GET.q|default:'' }}" class="border p-2 rounded" />
            <select name="doc_type" class="border p-2 rounded">
                <option value="">كل الأنواع</option>
                <option value="official" {% if request.GET.doc_type == 'official' %}selected{% endif %}>كتاب رسمي</option>
                <option value="administrative" {% if request.GET.doc_type == 'administrative' %}selected{% endif %}>أمر إداري</option>
                <option value="circular" {% if request.GET.doc_type == 'circular' %}selected{% endif %}>تعميم</option>
            </select>
            <input type="date" name="created_at" value="{{ request.GET.created_at|default:'' }}" class="border p-2 rounded" />
            <button type="submit" class="bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-900">بحث</button>
        </form>
        <!-- جدول الوثائق -->
<div class="overflow-x-auto rounded-xl shadow">
    <table class="min-w-full text-sm text-right">
        <thead class="bg-gray-100">
            <tr>
                <th class="px-4 py-2">📄 العنوان</th>
                <th class="px-4 py-2">📂 النوع</th>
                <th class="px-4 py-2">📆 الإنشاء</th>
                <th class="px-4 py-2">🛡️ الحالة</th>
                <th class="px-4 py-2">⚙️ الإجراءات</th>
            </tr>
        </thead>
        <tbody>
            {% for note in notes %}
            <tr class="border-t hover:bg-blue-50">
                <td class="px-4 py-2 font-semibold">{{ note.title }}</td>
                <td class="px-4 py-2">{{ note.get_doc_type_display }}</td>
                <td class="px-4 py-2">{{ note.created_at|date:"Y-m-d" }}</td>
                <td class="px-4 py-2">
                    {% if note.is_archived %}
                        <span class="text-pink-700 font-bold">مؤرشفة</span>
                    {% elif note.expiry_date and note.expiry_date < now %}
                        <span class="text-yellow-700 font-bold">منتهية</span>
                    {% else %}
                        <span class="text-green-700 font-bold">نشطة</span>
                    {% endif %}
                </td>
                <td class="px-4 py-2 flex flex-wrap gap-2">
                    <a href="{% url 'note_detail' note.access_token %}" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-700 transition text-sm">عرض</a>

                    {% if note.file %}
                    <a href="{{ note.file.url }}" download class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-700 transition text-sm">تحميل</a>
                    {% endif %}

                    <!-- زر الأرشفة -->
                    <form method="post" action="{% url 'archive_note' note.pk %}" class="inline">
                        {% csrf_token %}
                        <button type="submit" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition text-sm"
                                onclick="return confirm('هل تريد أرشفة هذه الوثيقة؟')">أرشفة</button>
                    </form>

                    <!-- زر الحذف -->
                    <form method="post" action="{% url 'delete_note' note.pk %}" class="inline">
                        {% csrf_token %}
                        <button type="submit" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition text-sm"
                                onclick="return confirm('⚠️ هل أنت متأكد من حذف هذه الوثيقة؟')">حذف</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if notes|length == 0 %}
        <div class="text-center text-gray-500 py-4">📭 لا توجد وثائق متاحة.</div>
    {% endif %}
</div>
    </div>
    <!-- النصف الثاني: الأخبار -->
    <div class="bg-white rounded-2xl shadow-xl p-6">
        <h2 class="text-2xl font-bold text-red-700 mb-4 flex items-center gap-2"><i class="fas fa-newspaper"></i> آخر الأخبار</h2>
        <div class="mb-4 text-center">
            <a href="{% url 'news' %}" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 shadow transition font-bold"><i class="fas fa-eye"></i> عرض كل الأخبار</a>
            {% if user_profile.role == 'admin' or user_profile.role == 'supervisor' %}
            <a href="{% url 'add_news' %}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 shadow transition font-bold ml-2"><i class="fas fa-plus"></i> نشر خبر جديد</a>
            {% endif %}
        </div>
        {% if news_list %}
        <ul class="space-y-4">
            {% for news in news_list|slice:':3' %}
            <li class="bg-gray-50 rounded-xl shadow p-4 flex gap-4 items-center">
                {% if news.image %}
                <img src="{{ news.image.url }}" alt="صورة الخبر" class="w-20 h-20 object-cover rounded-xl border">
                {% endif %}
                <div>
                    <h3 class="text-lg font-bold text-blue-700 mb-1">{{ news.title }}</h3>
                    <p class="text-gray-700 mb-2">{{ news.content|truncatechars:60 }}</p>
                    <span class="text-xs text-gray-500"><i class="fas fa-clock"></i> {{ news.created_at|date:"Y-m-d H:i" }}</span>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="text-center text-gray-400 py-8">لا توجد أخبار حالياً.</div>
        {% endif %}
    </div>
</div>

{% endblock %}
