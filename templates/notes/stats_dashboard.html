{% extends "base.html" %}
{% load static %}
{% block title %}لوحة الإحصائيات والتقارير - اتحاد الصحفيين العراقيين{% endblock %}
{% block content %}
<h2 class="text-2xl font-bold mb-6 text-blue-900">📈 لوحة الإحصائيات والتقارير</h2>

<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="bg-white rounded shadow p-6">
        <h3 class="font-bold mb-4">عدد الوثائق حسب النوع</h3>
        <canvas id="notesByType"></canvas>
    </div>
    <div class="bg-white rounded shadow p-6">
        <h3 class="font-bold mb-4">عدد الوثائق حسب الشهر</h3>
        <canvas id="notesByMonth"></canvas>
    </div>
    <div class="bg-white rounded shadow p-6">
        <h3 class="font-bold mb-4">عدد المستخدمين حسب الدور</h3>
        <canvas id="usersByRole"></canvas>
    </div>
</div>

<!-- هنا نمرر البيانات كـ JSON آمن -->
{{ notes_by_type_labels|json_script:"notesByTypeLabels" }}
{{ notes_by_type_data|json_script:"notesByTypeData" }}

{{ notes_by_month_labels|json_script:"notesByMonthLabels" }}
{{ notes_by_month_data|json_script:"notesByMonthData" }}

{{ users_by_role_labels|json_script:"usersByRoleLabels" }}
{{ users_by_role_data|json_script:"usersByRoleData" }}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // قراءة البيانات من العناصر المخفية
    const notesByTypeLabels = JSON.parse(document.getElementById('notesByTypeLabels').textContent);
    const notesByTypeData = JSON.parse(document.getElementById('notesByTypeData').textContent);

    new Chart(document.getElementById('notesByType'), {
        type: 'pie',
        data: {
            labels: notesByTypeLabels,
            datasets: [{
                data: notesByTypeData,
                backgroundColor: ['#1976d2','#388e3c','#fbc02d','#d32f2f','#7b1fa2']
            }]
        }
    });

    const notesByMonthLabels = JSON.parse(document.getElementById('notesByMonthLabels').textContent);
    const notesByMonthData = JSON.parse(document.getElementById('notesByMonthData').textContent);

    new Chart(document.getElementById('notesByMonth'), {
        type: 'bar',
        data: {
            labels: notesByMonthLabels,
            datasets: [{
                label: 'عدد الوثائق',
                data: notesByMonthData,
                backgroundColor: '#1976d2'
            }]
        }
    });

    const usersByRoleLabels = JSON.parse(document.getElementById('usersByRoleLabels').textContent);
    const usersByRoleData = JSON.parse(document.getElementById('usersByRoleData').textContent);

    new Chart(document.getElementById('usersByRole'), {
        type: 'doughnut',
        data: {
            labels: usersByRoleLabels,
            datasets: [{
                data: usersByRoleData,
                backgroundColor: ['#388e3c','#fbc02d','#d32f2f','#7b1fa2','#1976d2']
            }]
        }
    });
</script>
{% endblock %}
