{% extends "base.html" %}
{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†{% endblock %}
{% block content %}
<div class="flex items-center justify-between mb-4">
  <h2 class="text-xl font-bold">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
  <div class="flex gap-2">
    <a href="{% url 'add_user' %}" class="bg-blue-700 text-white px-3 py-1 rounded hover:bg-blue-900">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</a>
    <a href="{% url 'role_change_log' %}" class="bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700">Ø³Ø¬Ù„ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</a>
  </div>
</div>

<!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
  <div class="bg-blue-100 rounded-xl p-4 text-center shadow">
    <div class="text-2xl font-bold text-blue-700">{{ total_users }}</div>
    <div class="text-sm text-blue-900 mt-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
  </div>
  <div class="bg-green-100 rounded-xl p-4 text-center shadow">
    <div class="text-2xl font-bold text-green-700">{{ active_docs }}</div>
    <div class="text-sm text-green-900 mt-2">Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù†Ø´Ø·Ø©</div>
  </div>
  <div class="bg-pink-100 rounded-xl p-4 text-center shadow">
    <div class="text-2xl font-bold text-pink-700">{{ archived_docs }}</div>
    <div class="text-sm text-pink-900 mt-2">Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø¤Ø±Ø´ÙØ©</div>
  </div>
  <div class="bg-yellow-100 rounded-xl p-4 text-center shadow">
    <div class="text-2xl font-bold text-yellow-700">{% for r in roles_stats %}{{ r.count }} {% endfor %}</div>
    <div class="text-sm text-yellow-900 mt-2">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±</div>
    <div class="text-xs text-gray-600 mt-1">
      {% for r in roles_stats %}
        <span class="inline-block bg-gray-200 rounded px-2 py-1 m-1">{{ r.role }}: {{ r.count }}</span>
      {% endfor %}
    </div>
  </div>
</div>
{% if messages %}
  <ul class="mb-4">
    {% for message in messages %}
      <li style="color:{% if message.tags == 'error' %}red{% elif message.tags == 'success' %}green{% else %}#555{% endif %};font-weight:bold;">{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}
<table class="min-w-full divide-y divide-gray-200 bg-white rounded shadow">
    <thead class="bg-gray-100">
        <tr>
            <th class="px-4 py-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
            <th class="px-4 py-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
            <th class="px-4 py-2">Ø§Ù„Ø¯ÙˆØ±</th>
            <th class="px-4 py-2">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
    </thead>
    <tbody>
        {% for item in users_with_roles %}
        <tr>
            <td class="px-4 py-2">{{ item.user.username }}</td>
            <td class="px-4 py-2">{{ item.user.email }}</td>
            <td class="px-4 py-2">
                {% if item.user != request.user %}
                    {% if item.allowed_roles %}
                        {% include "notes/roles_choices.html" with user=item.user allowed_roles=item.allowed_roles %}
                    {% else %}
                        <select class="bg-gray-100 text-gray-400 px-2 py-1 rounded" disabled>
                            <option>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ØªØ¨ Ù…ØªØ§Ø­Ø© Ù„Ù„ØªØºÙŠÙŠØ±</option>
                        </select>
                    {% endif %}
                {% else %}
                    <span class="text-gray-400">{{ item.user.userprofile.role }}</span>
                {% endif %}
            </td>
            <td class="px-4 py-2">
                {% if item.user != request.user %}
                <form method="post" action="{% url 'delete_user' item.user.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="text-red-600 hover:underline" onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ');">Ø­Ø°Ù</button>
                </form>
                {% else %}
                <span class="text-gray-400">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù†ÙØ³Ùƒ</span>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="4" class="text-center py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</td></tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{# Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ ÙÙŠ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø· #}
{# Ù…Ø«Ø§Ù„: ÙÙŠ Ù‚Ø§Ù„Ø¨ Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙÙŠ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± (news_detail.html Ø£Ùˆ news.html)ØŒ Ø£Ø¶Ù Ø§Ù„ØªØ§Ù„ÙŠ Ø¯Ø§Ø®Ù„ ØªÙƒØ±Ø§Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª: #}
{#
{% for comment in news.comments.all %}
  <div class="comment-box">
    <div class="comment-content">{{ comment.content }}</div>
    <div class="comment-meta">Ø¨Ù‚Ù„Ù…: {{ comment.user.username }}</div>
    {% if request.user.is_superuser or request.user.profile.role == 'admin' or request.user.profile.role == 'supervisor' %}
      <form method="post" action="{% url 'delete_news_comment' comment.id %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="text-red-600 hover:underline" onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ØŸ');">Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</button>
      </form>
    {% endif %}
  </div>
{% endfor %}
#}
