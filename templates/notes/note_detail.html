{% extends 'base.html' %}
{% load static %}

{% block title %}Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©{% endblock %}

{% block content %}

<!-- âœ… Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Cairo', 'Tahoma', 'Arial', sans-serif;
    }
</style>

<div class="bg-white p-10 rounded-lg shadow-md max-w-4xl mx-auto print:p-0 print:shadow-none print:bg-white">

    <!-- âœ… Ø§Ù„Ø´Ø¹Ø§Ø± -->
    <div class="text-center mb-6 border-b pb-4">
        <img src="{% static 'logo.png' %}" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø§ØªØ­Ø§Ø¯" class="h-24 mx-auto">
        <h1 class="text-3xl font-bold text-blue-800 mt-2">Ø§ØªØ­Ø§Ø¯ Ø§Ù„ØµØ­ÙÙŠÙŠÙ† Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠÙŠÙ†</h1>
        <p class="text-sm text-gray-500">Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©</p>
    </div>

    <!-- âœ… Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© -->
    <div class="mb-6 leading-relaxed">
        <h2 class="text-xl font-bold mb-2">ğŸ“Œ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©:</h2>
        <p class="text-gray-800">{{ note.title }}</p>

        <h2 class="text-xl font-bold mt-4 mb-2">ğŸ“„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰:</h2>
        <p class="text-gray-700 whitespace-pre-line">{{ note.content }}</p>

        <div class="mt-6 grid grid-cols-2 gap-4 text-sm text-gray-600">
            <div>ğŸ“‚ Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©: <span class="font-semibold">{{ note.doc_type }}</span></div>
            <div>ğŸ‘¤ Ø£Ù†Ø´Ø¦Øª Ø¨ÙˆØ§Ø³Ø·Ø©: <span class="font-semibold">{{ note.created_by.username }}</span></div>
            <div>ğŸ§‘â€ğŸ’¼ Ø¥Ù„Ù‰: <span class="font-semibold">{{ note.recipient_name }}</span></div>
            <div>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: <span class="font-semibold">{{ note.created_at|date:"Y-m-d" }}</span></div>
            {% if note.expiry_date %}
            <div>â³ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: <span class="font-semibold">{{ note.expiry_date|date:"Y-m-d" }}</span></div>
            {% endif %}
        </div>

        {% if note.file %}
        <div class="mt-4">
            ğŸ“ Ù…Ø±ÙÙ‚: <a href="{{ note.file.url }}" class="text-blue-600 underline" target="_blank">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù (PDF)</a>
        </div>
        {% endif %}
    </div>

    <!-- âœ… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
    {% if user_profile.role == 'admin' or user_profile.role == 'supervisor' or user_profile.role == 'employee' %}
    <div class="mt-8 flex flex-wrap gap-4 justify-center no-print">
        <form method="post" action="{% url 'archive_note' note.id %}">
            {% csrf_token %}
            <button type="submit" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                ğŸ—‚ Ø£Ø±Ø´ÙØ©
            </button>
        </form>

        <form method="post" action="{% url 'delete_note' note.id %}"
            onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©ØŸ');">
            {% csrf_token %}
            <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                ğŸ—‘ Ø­Ø°Ù
            </button>
        </form>

        <button onclick="window.print()" class="bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800">
            ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©
        </button>

        <a href="{{ note_pdf_url }}" download class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            â¬‡ ØªØ­Ù…ÙŠÙ„ PDF
        </a>
    </div>
    {% endif %}

    <!-- âœ… Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div class="page-break print:block hidden mt-20 text-center">
        <h2 class="text-xl font-bold mb-4">ğŸ“ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„ÙˆØ«ÙŠÙ‚Ø©</h2>
        <img src="data:image/png;base64,{{ img_str }}" alt="QR Code" class="mx-auto h-48">
        {% if attachment_url %}
        <p class="mt-4 text-gray-600">Ø§Ù…Ø³Ø­ Ø§Ù„Ù€ QR Code Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±ÙÙ‚ Ù…Ø¨Ø§Ø´Ø±Ø©</p>
        {% else %}
        <p class="mt-4 text-gray-600">Ø§Ù…Ø³Ø­ Ø§Ù„Ù€ QR Code Ù„Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©</p>
        {% endif %}

        {% if security_warning %}
        <div class="text-red-600 text-sm mt-6 bg-red-50 border border-red-200 p-3 rounded w-full max-w-lg mx-auto">
            âš  {{ security_warning.message }}
        </div>
        {% endif %}

        <!-- âœ… ØªÙˆÙ‚ÙŠØ¹ ÙˆØ®ØªÙ… -->
        <div class="flex justify-between items-center mt-10 print:flex hidden">
            <div>
                <p class="font-semibold">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹:</p>
                <p class="mt-8">....................</p>
            </div>
            <div class="text-center">
                <p class="font-semibold">Ø§Ù„Ø®ØªÙ…:</p>
                <p class="mt-8 text-2xl">ğŸŸ¢â¬›ï¸ Ø®ØªÙ… Ø±Ø³Ù…ÙŠ</p>
            </div>
        </div>
    </div>
</div>

<!-- âœ… ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
<style>
    @media print {
        body {
            background: white;
            color: black;
            font-family: 'Cairo', 'Tahoma', 'Arial', sans-serif;
        }

        .page-break {
            page-break-before: always;
        }

        nav,
        .no-print {
            display: none !important;
        }
    }
</style>
{% endblock %}