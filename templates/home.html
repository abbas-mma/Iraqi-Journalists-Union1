{% extends 'notes/base.html' %}
{% load static %}

{% block title %}ููุญุฉ ุงูุชุญูู{% endblock %}

{% block content %}

<!-- โ ุนููุงู ุงูุตูุญุฉ -->
<h1 class="text-2xl font-bold mb-4 text-blue-900">๐ ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ</h1>

<!-- โ ุฃุฒุฑุงุฑ ุฅุฏุงุฑุฉ ุงููุซุงุฆู ูุงููุณุชุฎุฏููู -->
<div class="flex flex-wrap gap-3 mb-6">
    <a href="{% url 'create_note' %}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">โ ุฅูุดุงุก ูุซููุฉ</a>
    <a href="{% url 'archived_notes' %}" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">๐ ุงูุฃุฑุดูู</a>
    <a href="{% url 'expired_notes' %}" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">๐ ุงูููุชููุฉ</a>
    <a href="{% url 'outgoing_notes' %}" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">๐ค ุงูุตุงุฏุฑุฉ</a>
    <a href="{% url 'incoming_notes' %}" class="bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600">๐ฅ ุงููุงุฑุฏุฉ</a>
    <a href="{% url 'user_management' %}" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">๐ฅ ุงููุณุชุฎุฏููู</a>
    <a href="{% url 'stats_dashboard' %}" class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-black">๐ ุงูุฅุญุตุงุฆูุงุช</a>
</div>

<!-- โ ุฃุฒุฑุงุฑ ุงูุณุฌูุงุช ูุงูุฃูุดุทุฉ -->
<div class="flex flex-wrap gap-3 mb-6">
    <a href="{% url 'search_log' %}" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">๐ ุณุฌู ุงูุจุญุซ</a>
    <a href="{% url 'archive_log' %}" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">๐ ุณุฌู ุงูุฃุฑุดูุฉ</a>
    <a href="{% url 'login_history' %}" class="bg-green-800 text-white px-4 py-2 rounded hover:bg-green-900">๐ ุณุฌู ุงูุฏุฎูู</a>
    <a href="{% url 'role_change_log' %}" class="bg-yellow-800 text-white px-4 py-2 rounded hover:bg-yellow-900">๐ ุชุบููุฑ ุงูุฃุฏูุงุฑ</a>
    <a href="{% url 'activity_log' %}" class="bg-red-700 text-white px-4 py-2 rounded hover:bg-red-800">๐ ุณุฌู ุงูุฃูุดุทุฉ</a>
    <a href="{% url 'access_log' %}" class="bg-teal-700 text-white px-4 py-2 rounded hover:bg-teal-800">๐ ุณุฌู ุงููุตูู</a>
</div>

<!-- โ ุฅุญุตุงุฆูุงุช -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    <div class="bg-blue-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">ุงููุณุชุฎุฏููู</h4>
        <p class="text-2xl">{{ stats.users }}</p>
    </div>
    <div class="bg-green-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">ุงููุซุงุฆู ุงููุดุทุฉ</h4>
        <p class="text-2xl">{{ stats.active }}</p>
    </div>
    <div class="bg-yellow-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">ุงููุซุงุฆู ุงูููุชููุฉ</h4>
        <p class="text-2xl">{{ stats.expired }}</p>
    </div>
    <div class="bg-purple-100 p-4 rounded shadow text-center">
        <h4 class="font-bold">ุงููุซุงุฆู ุงููุคุฑุดูุฉ</h4>
        <p class="text-2xl">{{ stats.archived }}</p>
    </div>
</div>

<!-- โ ูููุฐุฌ ุงูุจุญุซ -->
<form method="get" class="bg-white p-4 rounded shadow mb-6 flex flex-wrap items-center gap-3">
    <input type="text" name="q" placeholder="ุจุญุซ ุจุนููุงู ุงููุซููุฉ..." value="{{ request.GET.q|default:'' }}"
           class="border p-2 rounded flex-1" />
    <select name="doc_type" class="border p-2 rounded">
        <option value="">ูู ุงูุฃููุงุน</option>
        <option value="official" {% if request.GET.doc_type == 'official' %}selected{% endif %}>ูุชุงุจ ุฑุณูู</option>
        <option value="administrative" {% if request.GET.doc_type == 'administrative' %}selected{% endif %}>ุฃูุฑ ุฅุฏุงุฑู</option>
        <option value="circular" {% if request.GET.doc_type == 'circular' %}selected{% endif %}>ุชุนููู</option>
    </select>
    <input type="date" name="created_at" value="{{ request.GET.created_at|default:'' }}" class="border p-2 rounded" />
    <button type="submit" class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-black">ุจุญุซ</button>
</form>

<!-- โ ุฌุฏูู ุงููุซุงุฆู -->
<div class="overflow-x-auto bg-white rounded shadow">
    <table class="min-w-full text-sm text-right">
        <thead class="bg-gray-100">
            <tr>
                <th class="px-4 py-2">๐ ุงูุนููุงู</th>
                <th class="px-4 py-2">๐ ุงูููุน</th>
                <th class="px-4 py-2">๐ ุงูุฅูุดุงุก</th>
                <th class="px-4 py-2">๐ก๏ธ ุงูุญุงูุฉ</th>
                <th class="px-4 py-2">๐ท ุงููุณูู</th>
                <th class="px-4 py-2">๐๏ธ ูุฑุงุช ุงููุตูู</th>
                <th class="px-4 py-2">โ๏ธ ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
        </thead>
        <tbody>
            {% for note in notes %}
            <tr class="border-t hover:bg-gray-50">
                <td class="px-4 py-2">{{ note.title }}</td>
                <td class="px-4 py-2">{{ note.get_doc_type_display }}</td>
                <td class="px-4 py-2">{{ note.created_at|date:"Y-m-d" }}</td>
                <td class="px-4 py-2">
                    {% if note.is_archived %}
                        <span class="text-yellow-600">ูุคุฑุดูุฉ</span>
                    {% elif note.expiry_date and note.expiry_date < now %}
                        <span class="text-red-600">ููุชููุฉ</span>
                    {% else %}
                        <span class="text-green-600">ูุดุทุฉ</span>
                    {% endif %}
                </td>
                <td class="px-4 py-2">
                    {% for tag in note.tags.all %}
                        <span class="bg-blue-200 text-blue-800 rounded px-2 py-1 text-xs">{{ tag.name }}</span>
                    {% empty %}
                        <span class="text-gray-400">ูุง ุชูุฌุฏ</span>
                    {% endfor %}
                </td>
                <td class="px-4 py-2 text-center">๐๏ธ {{ note.access_logs.count }}</td>
                <td class="px-4 py-2 text-center">
                    <a href="{% url 'note_detail' note.access_token %}" class="text-blue-600 hover:underline">ุนุฑุถ</a> |
                    <a href="{% url 'note_qr_only' note.access_token %}" class="text-blue-600 hover:underline">QR</a> |
                    {% if note.file %}
                        <a href="{{ note.file }}" download class="text-green-600 hover:underline">ุชุญููู</a> |
                    {% endif %}
                    {% if not note.is_archived %}
                        <a href="{% url 'archive_note' note.id %}" class="text-yellow-600 hover:underline">ุฃุฑุดูุฉ</a> |
                    {% endif %}
                    <a href="{% url 'delete_note' note.id %}" class="text-red-600 hover:underline"
                       onclick="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงููุซููุฉุ')">ุญุฐู</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center text-gray-500 py-4">๐ญ ูุง ุชูุฌุฏ ูุซุงุฆู ูุชุงุญุฉ.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
